version: v1.0
name: Autofix CI
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Debug and fix
    task:
      jobs:
        - name: Codex
          commands:
            - checkout
            - git config --global user.email "ci@semaphore.io"
            - git config --global user.name "Semaphore CI"
            - 'git remote set-url origin https://$GITHUB_TOKEN:x-oauth-basic@github.com/${SEMAPHORE_GIT_REPO_SLUG}.git'
            - '#npm install -g @openai/codex'
            - '#printenv OPENAI_API_KEY | codex login --with-api-key'
      secrets:
        - name: github
        - name: openai-api
