version: v1.0
name: Test and Lint Pipeline
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2404
blocks:
  - name: Install Dependencies
    dependencies: []
    task:
      jobs:
        - name: npm install
          commands:
            - checkout
            - nvm install
            - nvm use
            - cache restore
            - npm install
            - cache store
  - name: Lint
    dependencies:
      - Install Dependencies
    task:
      jobs:
        - name: Run jshint
          commands:
            - checkout
            - nvm install
            - nvm use
            - cache restore
            - npm run lint
  - name: Test
    dependencies:
      - Install Dependencies
    task:
      jobs:
        - name: Run unit tests
          commands:
            - checkout
            - nvm install
            - nvm use
            - cache restore
            - npm test
            - test-results publish junit.xml
after_pipeline:
  task:
    jobs:
      - name: Process test results
        commands:
          - test-results gen-pipeline-report
